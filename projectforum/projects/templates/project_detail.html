{% extends "base.html" %}
{% load staticfiles %}

{% block header %}
    <link rel="stylesheet" type="text/css"
        href="{% static 'external/jqueryui/jquery-ui.min.css' %}">
    <link rel="stylesheet" type="text/css"
        href="{% static 'external/jqueryraty/jquery.raty.css' %}">
    <script src="{% static 'external/jqueryraty/jquery.raty.js' %}"></script>
    <script src="{% static 'js/project-detail.js' %}"></script>
{% endblock %}

{% block content %}
            <div class='project_header'>
                <h4 class='project_status'>{{ project.get_status_display }}</h4>
                <div class='title_tab'>
                    <h3 class='project_title'>{{ project.title }}</h3>
                </div>
            </div>
    <ul class='project_details'>
        <li>
            <p class='project_description'>{{ project.description }}</p>
        </li>
        <li>
            Owner: <a href="{% url 'profile:view' project.owner.username %}">{{ project.owner.username }}</a> </p>
            <p> Compensation: ${{ project.amount }} {{ project.get_payment_display }} </p>
            <p> Posted: {{ project.timestamp }} </p>
        </li>
    </ul>


    {% if user == project.owner %}
        <h4>Applicants:</h4>
        <ul class='applicant_list people_list'>
        {% for applicant in project.applicants.all %}
            <li class='people_list_element'>
                <span><a href="{% url 'profile:view' applicant.username %}">{{ applicant.username }}</a>, {{ applicant.email }}</span>
                <button id='accept_applicant'
                        class='btn glyphicon glyphicon-ok accept_button accept_applicant_button'
                        title="Add applicant to your project's team."
                        data-projectid="{{ project.id }}"
                        data-applicantusername="{{ applicant.username }}"
                        aria-hidden="true">
                </button>
            </li>
        {% empty %}
            <li class='empty_people_list_element'>No applicants currently.</li>
        {% endfor %}
        </ul>

        <h4>Team Members:</h4>
        <ul class='member_list people_list'>
        {% for member in project.team_members.all %}
            <li class='member_list people_list_element'>
                <a href="{% url 'profile:view' member.username %}">{{ member.username }}</a>, {{ member.email }}
            </li>
        {% empty %}
            <li class='empty_people_list_element'>
                No team members currently.
            </li>
        {% endfor %}
        </ul>

        {% if project.status == 1 %}
            <button id='close_applications' class='btn btn-default' data-projectid="{{ project.id }}">
                Close Applications
            </button>
        {% endif %}

        {% if project.status == 2 %}
            <button id='reopen_applications' class='btn btn-default' data-projectid="{{ project.id }}">
                Re-Open Applications
            </button>
        {% endif %}

        {% if project.status == 3 or project.status == 4 %}
            <button id='reopen_project' class='btn btn-default' data-projectid="{{ project.id }}">
                Re-Open Project
            </button>
        {% endif %}

        {% if project.status != 4 and project.status != 3%}
            <button id='mark_complete' class='btn accept_button' data-projectid="{{ project.id }}">
                Mark as Complete
            </button>

            <button id='cancel_project' class='btn cancel_button' data-projectid="{{ project.id }}">
                Cancel Project
            </button>
        {% endif %}

    {% elif user in project.team_members.all %}
        Owner:
        <ul class='owner_list people_list'>
            <li class='people_list_element'>
                {{ project.owner.username }}, {{ applicant.email }}
            </li>
        </ul>

        Team Members:
        <ul class='member_list people_list'>
        {% for member in project.team_members.all %}
            <li class='people_list_element'>
                {{ member.username }}, {{ member.email }}
            </li>
        {% endfor %}
        </ul>

    {% elif project.status == 1 %}
        {% if not logged_in %}
            <button class='btn'>Log in to apply!</button>
        {% elif user in project.applicants.all %}

            Your application has been submitted. The project owner is
            reviewing your application.

            <button id='withdraw_application_button'
                    class='btn cancel_button withdraw_application_button'
                    data-projectid="{{ project.id }}">
                Withdraw Application
            </button>

        {% else %}
            <button id='apply_button'
                    class='btn apply_button accept_button'
                    data-projectid="{{ project.id }}"
                    title="Apply to join project team.">
                Apply
            </button>

        {% endif %}

    {% endif %}

    {% if project.status == 3 or project.status == 4 %}
        <br/>
        <br/>
        <label>Reviews:</label>
        <br/>
        {% if user in project.team_members.all %}
            <form action="/ratings/review/{{project.id}}" method="post">
                {% csrf_token %}
                <div id="rating"></div>
                Comments:
                <br/>
                {{ form.comment }}
                <br/>
                <input type="submit" value="Submit" />

            </form>
        {% endif %}
        {% for review in project_reviews %}
            <hr>
            <div class="project-review">
                <div class="review-score"
                     data-score="{{ review.score }}">
                </div>
                <br/>
                <div class="review-comment">
                    {{ review.comment | escape }}
                </div>
                <br/>
                review.reviewer.username
            </div>
            <br>            
        {% endfor %}
    {% endif %}
{% endblock %}
